user  nobody;
worker_processes  4;

worker_rlimit_nofile 65536;

error_log  logs/error.log error;

pid        /var/run/nginx.pid;

events {
    use epoll;
    worker_connections 101784;
}

http {
    include       /usr/local/nginx/conf/mime.types;
    default_type  application/octet-stream;
    access_log  logs/access.log;
    server_tokens off;

    sendfile        on;

    keepalive_timeout  10;

    proxy_buffering on;
    #proxy_buffer_size 4k;
    #proxy_buffers 8 8k;
    proxy_connect_timeout 20;

    add_header Vary Accept-Encoding;
    add_header X-NG src-beijing;
    proxy_set_header Host $host;
    proxy_hide_header ETag;
    proxy_hide_header Vary;
    proxy_set_header X-Real-IP $remote_addr;


    upstream src-cntv-jn{
        server 123.129.252.13;
    }

    upstream src-cntv-bj{
        server 202.108.9.107;
    }

   # upstream src-cntv-bj2{
   #     server 202.108.8.38;
   # }

    upstream src-cntv-gz{
    #    server 123.129.252.13;
         server 121.14.55.38;
    }

    #upstream src-cntv-gz2{
    #    server 202.108.8.38;
    #}

    upstream myws{
        server <%= slbvip %>:81;
    }


#----------------------  proxy  --------------------------
    server {
        listen       <%= slbvip %>:80;
        server_name  _;

        proxy_next_upstream error timeout http_404 http_502 http_504;
        proxy_intercept_errors on;


        location ~ .*crossdomain\.(xml) {
              root /var/www/html/;
        }
	
        location ~ .*\.(xml|XML|swf|SWF|exe|EXE|js|JS|html|HTML|shtml|SHTML)$ {
                proxy_pass  http://src-cntv-bj;
        }

        location ~*  {
		proxy_pass  http://myws;
        }    
    }
}
